-- Load Rayfield (working link as of 2026)
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Create the main window
local Window = Rayfield:CreateWindow({
    Name = "HM Hub",
    LoadingTitle = "LOADING HM HUB...",
    LoadingSubtitle = "By Tha Hollows",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "HMhub",
        FileName = "Config"
    },
    KeySystem = false,
})

-- Main tab
local MainTab = Window:CreateTab("Main", 4483362458)

-- Variables
local autoClick = false
local autoStat = false
local selectedStat = "Energy"  -- Default


local ClickToggle = MainTab:CreateToggle({
    Name = "Auto Clicker",
    CurrentValue = false,
    Flag = "AutoClickToggle",
    
    Callback = function(Value)
        autoClick = Value
        
        if Value then
            Rayfield:Notify({
                Title = "Auto Clicker",
                Content = "Clicking every ~0.03s...",
                Duration = 3
            })
            
            task.spawn(function()
                while autoClick do
                    pcall(function()
                        local clickRemote = game:GetService("ReplicatedStorage")
                            :WaitForChild("Packages")
                            :WaitForChild("_Index")
                            :WaitForChild("sleitnick_knit@1.5.1")
                            :WaitForChild("knit")
                            :WaitForChild("Services")
                            :WaitForChild("ClickService")
                            :WaitForChild("RF")
                            :WaitForChild("Click")
                        
                        clickRemote:InvokeServer()
                    end)
                    
                    task.wait(0.1)  -- Increase to 0.1 if you get kicked
                end
            end)
        end
    end,
})

task.wait(0.5)
local Tab = Window:CreateTab("Misc", 4483362458) -- Title, Image

local autoBuyTitleEnabled = false

local AutoTitleToggle = MiscTab:CreateToggle({
    Name = "Auto Buy Best Title",
    CurrentValue = false,
    Flag = "AutoBuyTitle",
    
    Callback = function(Value)
        autoBuyTitleEnabled = Value
        
        if Value then
            Rayfield:Notify({
                Title = "Auto Buy Titles",
                Content = "Trying to buy the best available title every 30s...",
                Duration = 4
            })
            
            task.spawn(function()
                while autoBuyTitleEnabled do
                    local success, err = pcall(function()
                        -- Adjust this remote path if titles are under a different service
                        local titlesRemote = game:GetService("ReplicatedStorage")
                            :WaitForChild("Packages")
                            :WaitForChild("_Index")
                            :WaitForChild("sleitnick_knit@1.5.1")
                            :WaitForChild("knit")
                            :WaitForChild("Services")
                            :WaitForChild("TitlesService")  -- Change if it's called something else (e.g. TitleService)
                            :WaitForChild("RF")
                            :WaitForChild("BuyBestTitle")   -- Common name - change to actual remote name if different
                        
                        titlesRemote:InvokeServer()  -- No args = buy best/available
                    end)
                    
                    if not success then
                        warn("Auto Buy Title error:", tostring(err))
                        Rayfield:Notify({
                            Title = "Auto Buy Failed",
                            Content = "Remote error – stopping. Check console.",
                            Duration = 6
                        })
                        autoBuyTitleEnabled = false
                        break
                    end
                    
                    task.wait(30)  -- Safe delay – adjust to 15–60s based on rate limits
                end
            end)
        else
            Rayfield:Notify({
                Title = "Auto Buy Titles",
                Content = "Stopped.",
                Duration = 3
            })
        end
    end,
})

Tab:CreateToggle({
    Name = "Auto Rank Up",  -- Changed from "Auto Ascension"
    CurrentValue = false,
    Flag = "AutoRankUp",    -- Updated flag name to match (avoids old config conflict)
    
    Callback = function(Value)
        getgenv().AutoRankUp = Value
        
        if Value then
            Rayfield:Notify({
                Title = "Auto Rank Up",
                Content = "Ranking up every 60s...",
                Duration = 4
            })
            
            task.spawn(function()
                while getgenv().AutoRankUp do
                    local success, err = pcall(function()
                        game:GetService("ReplicatedStorage")
                            :WaitForChild("Packages")
                            :WaitForChild("_Index")
                            :WaitForChild("sleitnick_knit@1.5.1")
                            :WaitForChild("knit")
                            :WaitForChild("Services")
                            :WaitForChild("RankupService")
                            :WaitForChild("RF")
                            :WaitForChild("RankUp")
                            :InvokeServer()
                    end)
                    
                    if not success then
                        warn("Auto Rank Up error: " .. tostring(err))
                        Rayfield:Notify({
                            Title = "Auto Rank Up Error",
                            Content = "Failed to rank up – check console. Stopping...",
                            Duration = 6
                        })
                        getgenv().AutoRankUp = false
                        break
                    end
                    
                    task.wait(60)  -- Safe 60-second delay (adjust if needed)
                end
            end)
        else
            Rayfield:Notify({
                Title = "Auto Rank Up",
                Content = "Stopped.",
                Duration = 3
            })
        end
    end,
})

-- =====================================
-- TELEPORT TO MACHINES IN workspace.Machines
-- Uses workspace.Players for your HRP
-- =====================================

local machinesFolder = workspace:WaitForChild("Machines")
local player = game.Players.LocalPlayer

-- Get unique names from Machines folder
local function getMachineNames()
    local names = {}
    local seen = {}

    for _, child in ipairs(machinesFolder:GetChildren()) do
        local name = child.Name
        if name and not seen[name] then
            seen[name] = true
            table.insert(names, name)
        end
    end

    table.sort(names)
    
    if #names == 0 then
        table.insert(names, "No machines found")
    end
    
    return names
end

-- Dropdown
local selectedMachine = nil

local MachinesDropdown = Tab:CreateDropdown({
    Name = "Select Machine",
    Options = getMachineNames(),
    CurrentOption = {"None"},
    MultipleOptions = false,
    Flag = "MachineTPDropdown",
    
    Callback = function(Option)
        selectedMachine = Option and Option[1]
        
        if selectedMachine and selectedMachine ~= "No machines found" and selectedMachine ~= "None" then
            Rayfield:Notify({
                Title = "Selected",
                Content = "Ready to TP: " .. selectedMachine,
                Duration = 3
            })
            print("Selected machine:", selectedMachine)
        else
            selectedMachine = nil
        end
    end,
})

-- Refresh list
Tab:CreateButton({
    Name = "Refresh Machines",
    Callback = function()
        local newOptions = getMachineNames()
        MachinesDropdown:Refresh(newOptions, true)
        MachinesDropdown:Set({"None"})
        selectedMachine = nil
        Rayfield:Notify({
            Title = "Refreshed",
            Content = #newOptions .. " machines found",
            Duration = 3
        })
    end,
})

-- Teleport button using HRP from workspace.Players
Tab:CreateButton({
    Name = "Teleport",
    Callback = function()
        if not selectedMachine or selectedMachine == "No machines found" or selectedMachine == "None" then
            Rayfield:Notify({
                Title = "Error",
                Content = "Select a machine first!",
                Duration = 4
            })
            return
        end
        
        local machine = machinesFolder:FindFirstChild(selectedMachine)
        if not machine then
            Rayfield:Notify({
                Title = "Error",
                Content = selectedMachine .. " not found",
                Duration = 4
            })
            return
        end
        
        -- Get your character from workspace.Players
        local playerFolder = workspace:WaitForChild("Players")
        local playerChar = playerFolder:FindFirstChild(player.Name)
        if not playerChar then
            Rayfield:Notify({
                Title = "Error",
                Content = "Your character not found in workspace.Players",
                Duration = 4
            })
            return
        end
        
        -- Find HRP
        local hrp = playerChar:FindFirstChild("HumanoidRootPart")
        if not hrp then
            Rayfield:Notify({
                Title = "Error",
                Content = "No HumanoidRootPart found",
                Duration = 4
            })
            return
        end
        
        -- Get target CFrame (prefer PrimaryPart if Model, else Position)
        local targetCFrame
        if machine.PrimaryPart then
            targetCFrame = machine.PrimaryPart.CFrame
        elseif machine:IsA("BasePart") then
            targetCFrame = machine.CFrame
        else
            -- Fallback for other objects
            local firstPart = machine:FindFirstChildWhichIsA("BasePart", true)
            targetCFrame = firstPart and firstPart.CFrame or CFrame.new(machine.Position or Vector3.new())
        end
        
        -- Teleport 5 studs above
        hrp.CFrame = targetCFrame + Vector3.new(0, 5, 0)
        
        Rayfield:Notify({
            Title = "Teleport Success!",
            Content = "Moved to: " .. selectedMachine,
            Duration = 4
        })
        
        print("Teleported to:", selectedMachine, "at", targetCFrame.Position)
    end,
})


task.wait(0.5)
local Tab = Window:CreateTab("Auto Quest + Farm", 4483362458) -- Title, Image

-- =====================================
-- AUTO DETECT ISLAND + MOB DROPDOWN + AUTO FARM
-- Uses workspace.Maps and workspace.Mobs
-- =====================================

local player = game.Players.LocalPlayer
local mapsFolder = workspace:WaitForChild("Maps")
local mobsFolder = workspace:WaitForChild("Mobs")

local currentIslandName = nil
local currentMobFolder = nil
local selectedMobType = nil
local autoFarmEnabled = false
local farmDelay = 5

-- Detect current island by checking which map is loaded / closest
local function detectCurrentIsland()
    local character = player.Character
    if not character then return nil end
    local root = character:FindFirstChild("HumanoidRootPart")
    if not root then return nil end

    local playerPos = root.Position
    local closestName = nil
    local minDist = math.huge

    -- Method 1: Check which map folder exists and has mobs
    for _, map in ipairs(mapsFolder:GetChildren()) do
        if map:IsA("Folder") then
            local mobSubFolder = mobsFolder:FindFirstChild(map.Name)
            if mobSubFolder and #mobSubFolder:GetChildren() > 0 then
                -- Calculate average distance
                local totalDist = 0
                local count = 0
                for _, mob in ipairs(mobSubFolder:GetChildren()) do
                    if mob:IsA("BasePart") then
                        totalDist = totalDist + (playerPos - mob.Position).Magnitude
                        count = count + 1
                    end
                end
                if count > 0 then
                    local avg = totalDist / count
                    if avg < minDist then
                        minDist = avg
                        closestName = map.Name
                    end
                end
            end
        end
    end

    return closestName
end

-- Get unique mob types from current island
local function getMobTypes(islandName)
    if not islandName then return {"No island detected"} end
    
    local mobSubFolder = mobsFolder:FindFirstChild(islandName)
    if not mobSubFolder then return {"No mobs in " .. islandName} end

    local types = {}
    local seen = {}

    for _, child in ipairs(mobSubFolder:GetChildren()) do
        if child:IsA("BasePart") then
            local baseName = child.Name:gsub("_%d+$", "")  -- Remove _1, _2, etc.
            if baseName ~= "" and not seen[baseName] then
                seen[baseName] = true
                table.insert(types, baseName)
            end
        end
    end

    table.sort(types)
    return #types > 0 and types or {"No mobs found"}
end

-- Create/Update Dropdown
local MobDropdown

local function refreshDropdown()
    currentIslandName = detectCurrentIsland()
    if currentIslandName then
        currentMobFolder = mobsFolder:FindFirstChild(currentIslandName)
    end

    local options = getMobTypes(currentIslandName)

    if MobDropdown then
        MobDropdown:Refresh(options, true)
    else
        MobDropdown = Tab:CreateDropdown({
            Name = "Mobs on Current Island",
            Options = options,
            CurrentOption = {},
            MultipleOptions = false,
            Flag = "CurrentIslandMobs",
            Callback = function(Option)
                selectedMobType = Option[1]
                print("Selected mob type:", selectedMobType, "on", currentIslandName)
            end,
        })
    end
end

-- Auto Farm Toggle
local AutoFarmToggle = Tab:CreateToggle({
    Name = "Auto Farm (Random TP)",
    CurrentValue = false,
    Flag = "AutoFarmToggle",
    
    Callback = function(Value)
        autoFarmEnabled = Value
        
        if Value then
            if not selectedMobType or not currentMobFolder then
                Rayfield:Notify({Title = "Error", Content = "Scan island & select mob first!", Duration = 5})
                autoFarmEnabled = false
                return
            end

            Rayfield:Notify({
                Title = "Auto Farm ON",
                Content = "Farming " .. selectedMobType .. " on " .. currentIslandName,
                Duration = 5
            })

            task.spawn(function()
                while autoFarmEnabled do
                    local matches = {}
                    for _, mob in ipairs(currentMobFolder:GetChildren()) do
                        if mob:IsA("BasePart") and mob.Name:match("^" .. selectedMobType .. "(_%d+)?$") then
                            table.insert(matches, mob)
                        end
                    end

                    if #matches > 0 then
                        local target = matches[math.random(1, #matches)]
                        local char = player.Character
                        local hrp = char and char:FindFirstChild("HumanoidRootPart")
                        
                        if hrp then
                            hrp.CFrame = target.CFrame * CFrame.new(math.random(-4,4), 6, math.random(-6,-3))
                        end
                    end
                    
                    task.wait(farmDelay)
                end
            end)
        else
            Rayfield:Notify({Title = "Auto Farm OFF", Duration = 3})
        end
    end,
})

-- Main Scan Button
Tab:CreateButton({
    Name = "Scan Current Island & Load Mobs",
    Callback = function()
        refreshDropdown()
        Rayfield:Notify({
            Title = "Island Detected",
            Content = currentIslandName and (currentIslandName .. " loaded") or "No island detected",
            Duration = 5
        })
    end,
})

-- Delay Slider
Tab:CreateSlider({
    Name = "TP Delay",
    Range = {2, 15},
    Increment = 0.5,
    Suffix = "s",
    CurrentValue = 5,
    Flag = "FarmDelay",
    Callback = function(Value)
        farmDelay = Value
    end,
})

-- Status
Tab:CreateLabel("Stand on an island → Click Scan → Select mob → Turn Auto Farm ON")
