local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "HM HUB",
    LoadingTitle = "Loading HM HUB",
    LoadingSubtitle = "by The Hollows",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = nil,           -- nil = default folder
        FileName = "HM Hub"
    },
    KeySystem = false
})

local MainTab = Window:CreateTab("Player", 7072718362) 

-- Dropdown: Shows Humanoid.DisplayName grouped by inferred world (from name)

local function getServerMobsGroupedByName()
    local options = {"None / No Mobs Found"}
    
    local serverFolder = workspace
        :FindFirstChild("Worlds")
        and workspace.Worlds:FindFirstChild("Targets")
        and workspace.Worlds.Targets:FindFirstChild("Server")
    
    if not serverFolder then
        return options
    end
    
    local seen = {}
    
    -- Helper to guess world from mob name (customize patterns as needed)
    local function guessWorld(name)
        name = name:lower()
        if name:find("namex") or name:find("w1") or name:find("world1") then
            return "World 1"
        elseif name:find("colosseum") or name:find("arena") or name:find("w2") then
            return "World 2"
        elseif name:find("dungeon") or name:find("dung") or name:find("w4") then
            return "World 4"
        elseif name:find("demon") or name:find("island3") or name:find("w3") then
            return "Island 3"  -- placeholder for when it appears
        else
            return "Unknown World"
        end
    end
    
    -- Scan direct children
    for _, child in ipairs(serverFolder:GetChildren()) do
        if child:IsA("Model") then
            local humanoid = child:FindFirstChildOfClass("Humanoid")
            local displayName = humanoid and humanoid.DisplayName or nil
            local nameToShow = displayName and displayName ~= "" and displayName or child.Name
            
            local world = guessWorld(nameToShow)
            local fullLabel = "[" .. world .. "] " .. nameToShow
            
            if nameToShow and not seen[fullLabel] then
                seen[fullLabel] = true
                table.insert(options, fullLabel)
            end
        end
    end
    
    -- Optional: deeper scan
    for _, descendant in ipairs(serverFolder:GetDescendants()) do
        if descendant:IsA("Model") and descendant:FindFirstChildOfClass("Humanoid") then
            local humanoid = descendant:FindFirstChildOfClass("Humanoid")
            local displayName = humanoid and humanoid.DisplayName or nil
            local nameToShow = displayName and displayName ~= "" and displayName or descendant.Name
            
            local world = guessWorld(nameToShow)
            local fullLabel = "[" .. world .. "] " .. nameToShow
            
            if nameToShow and not seen[fullLabel] then
                seen[fullLabel] = true
                table.insert(options, fullLabel)
            end
        end
    end
    
    table.sort(options)
    return options
end

-- Dropdown
local selectedMob = "None / No Mobs Found"

local MobDropdown = MainTab:CreateDropdown({
    Name = "Server Mobs by Inferred World",
    Options = getServerMobsGroupedByName(),
    CurrentOption = {"None / No Mobs Found"},
    MultipleOptions = false,
    Flag = "ServerMobListGroupedByName",
    Callback = function(option)
        selectedMob = option[1]
        Rayfield:Notify({
            Title = "Mob Selected",
            Content = "Now selected: " .. selectedMob,
            Duration = 4
        })
        print("Selected mob:", selectedMob)
    end,
})

-- Manual refresh button
MainTab:CreateButton({
    Name = "ðŸ”„ Refresh Mob List (by World)",
    Callback = function()
        local newOptions = getServerMobsGroupedByName()
        MobDropdown:Refresh(newOptions, true)
        
        Rayfield:Notify({
            Title = "Mob List Updated",
            Content = "Found " .. (#newOptions - 1) .. " mobs",
            Duration = 4
        })
    end,
})

-- Auto-refresh
local serverFolder = workspace
    :WaitForChild("Worlds", 10)
    :WaitForChild("Targets", 10)
    :WaitForChild("Server", 10)

if serverFolder then
    serverFolder.ChildAdded:Connect(function()
        task.delay(0.8, function()
            MobDropdown:Refresh(getServerMobsGroupedByName(), false)
        end)
    end)
    
    serverFolder.ChildRemoved:Connect(function()
        task.delay(0.8, function()
            MobDropdown:Refresh(getServerMobsGroupedByName(), false)
        end)
    end)
    
    print("[Mob Dropdown] Auto-refresh enabled - grouped by name pattern")
end

-- Initial load
task.delay(1.2, function()
    MobDropdown:Refresh(getServerMobsGroupedByName(), true)
end)
