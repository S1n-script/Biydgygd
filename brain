-- Load Rayfield (working link as of 2026)
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Create the main window
local Window = Rayfield:CreateWindow({
    Name = "HM Hub",
    LoadingTitle = "LOADING HM HUB...",
    LoadingSubtitle = "By Tha Hollows",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "HMhub",
        FileName = "Config"
    },
    KeySystem = false,
})

-- Main tab
local MainTab = Window:CreateTab("Main", 4483362458)

-- Variables
local autoClick = false
local autoStat = false
local selectedStat = "Energy"  -- Default

-- =====================================
-- AUTO CLICKER
-- =====================================
local ClickToggle = MainTab:CreateToggle({
    Name = "Auto Clicker",
    CurrentValue = false,
    Flag = "AutoClickToggle",
    
    Callback = function(Value)
        autoClick = Value
        
        if Value then
            Rayfield:Notify({
                Title = "Auto Clicker",
                Content = "Clicking every ~0.03s...",
                Duration = 3
            })
            
            task.spawn(function()
                while autoClick do
                    pcall(function()
                        local clickRemote = game:GetService("ReplicatedStorage")
                            :WaitForChild("Packages")
                            :WaitForChild("_Index")
                            :WaitForChild("sleitnick_knit@1.5.1")
                            :WaitForChild("knit")
                            :WaitForChild("Services")
                            :WaitForChild("ClickService")
                            :WaitForChild("RF")
                            :WaitForChild("Click")
                        
                        clickRemote:InvokeServer()
                    end)
                    
                    task.wait(0.1)  -- Increase to 0.1 if you get kicked
                end
            end)
        end
    end,
})

task.wait(0.5)
local Tab = Window:CreateTab("Misc", 4483362458) -- Title, Image

Tab:CreateToggle({
    Name = "Auto Rank Up",  -- Changed from "Auto Ascension"
    CurrentValue = false,
    Flag = "AutoRankUp",    -- Updated flag name to match (avoids old config conflict)
    
    Callback = function(Value)
        getgenv().AutoRankUp = Value
        
        if Value then
            Rayfield:Notify({
                Title = "Auto Rank Up",
                Content = "Ranking up every 60s...",
                Duration = 4
            })
            
            task.spawn(function()
                while getgenv().AutoRankUp do
                    local success, err = pcall(function()
                        game:GetService("ReplicatedStorage")
                            :WaitForChild("Packages")
                            :WaitForChild("_Index")
                            :WaitForChild("sleitnick_knit@1.5.1")
                            :WaitForChild("knit")
                            :WaitForChild("Services")
                            :WaitForChild("RankupService")
                            :WaitForChild("RF")
                            :WaitForChild("RankUp")
                            :InvokeServer()
                    end)
                    
                    if not success then
                        warn("Auto Rank Up error: " .. tostring(err))
                        Rayfield:Notify({
                            Title = "Auto Rank Up Error",
                            Content = "Failed to rank up – check console. Stopping...",
                            Duration = 6
                        })
                        getgenv().AutoRankUp = false
                        break
                    end
                    
                    task.wait(60)  -- Safe 60-second delay (adjust if needed)
                end
            end)
        else
            Rayfield:Notify({
                Title = "Auto Rank Up",
                Content = "Stopped.",
                Duration = 3
            })
        end
    end,
})

-- =====================================
-- SCAN workspace.Machines + SHOW POSITIONS
-- =====================================

local machinesFolder = workspace:WaitForChild("Machines")
local player = game.Players.LocalPlayer

local selectedMachineName = nil  -- stores the name you picked

-- Get unique names
local function getMachinesList()
    local names = {}
    local seen = {}

    for _, child in ipairs(machinesFolder:GetChildren()) do
        local name = child.Name
        if name and not seen[name] then
            seen[name] = true
            table.insert(names, name)
        end
    end

    table.sort(names)
    
    if #names == 0 then
        table.insert(names, "No machines found")
    end
    
    return names
end

-- Dropdown
local MachinesDropdown = Tab:CreateDropdown({
    Name = "Select Machine",
    Options = getMachinesList(),
    CurrentOption = {"None"},
    MultipleOptions = false,
    Flag = "MachinesDropdown",
    
    Callback = function(Option)
        selectedMachineName = Option and Option[1]
        
        if selectedMachineName and selectedMachineName ~= "No machines found" and selectedMachineName ~= "None" then
            Rayfield:Notify({
                Title = "Selected",
                Content = selectedMachineName,
                Duration = 3
            })
            print("Selected machine type:", selectedMachineName)
        else
            selectedMachineName = nil
        end
    end,
})

-- Refresh
Tab:CreateButton({
    Name = "Refresh List",
    Callback = function()
        local newOptions = getMachinesList()
        MachinesDropdown:Refresh(newOptions, true)
        MachinesDropdown:Set({"None"})
        selectedMachineName = nil
        Rayfield:Notify({
            Title = "Refreshed",
            Content = #newOptions .. " unique machines",
            Duration = 3
        })
    end,
})

-- Button: Show positions of all items with the selected name
Tab:CreateButton({
    Name = "Show Positions of Selected Machine",
    Callback = function()
        if not selectedMachineName or selectedMachineName == "No machines found" or selectedMachineName == "None" then
            Rayfield:Notify({
                Title = "Nothing selected",
                Content = "Pick a machine from the dropdown first!",
                Duration = 4
            })
            return
        end
        
        local matches = {}
        local count = 0
        
        for _, child in ipairs(machinesFolder:GetChildren()) do
            if child.Name == selectedMachineName then
                count = count + 1
                local pos = child.Position or (child.PrimaryPart and child.PrimaryPart.Position)
                if pos then
                    table.insert(matches, {
                        name = child.Name,
                        fullName = child:GetFullName(),
                        position = pos
                    })
                end
            end
        end
        
        if count == 0 then
            Rayfield:Notify({
                Title = "Not Found",
                Content = "No '" .. selectedMachineName .. "' found right now",
                Duration = 4
            })
            return
        end
        
        -- Build message
        local msg = "Found " .. count .. "x '" .. selectedMachineName .. "':\n"
        for i, item in ipairs(matches) do
            local p = item.position
            msg = msg .. i .. ". " .. string.format("(%d, %d, %d)\n", math.floor(p.X), math.floor(p.Y), math.floor(p.Z))
            print(i .. ". " .. item.fullName .. " at " .. tostring(p))
        end
        
        Rayfield:Notify({
            Title = "Positions for " .. selectedMachineName,
            Content = msg,
            Duration = 8  -- longer because it may have multiple lines
        })
    end,
})

-- Status
Tab:CreateLabel("Refresh → Select machine → Show Positions")

task.wait(0.5)
local Tab = Window:CreateTab("Auto Quest + Farm", 4483362458) -- Title, Image

