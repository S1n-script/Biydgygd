local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "HM HUB",
    LoadingTitle = "Loading HM HUB",
    LoadingSubtitle = "by The Hollows",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = nil,           -- nil = default folder
        FileName = "HM Hub"
    },
    KeySystem = false
})

local MainTab = Window:CreateTab("Player", 7072718362) 

-- Dropdown: Shows unique mob TYPES from workspace.Worlds.Targets.Server (via "Name" attribute)

local function getServerMobTypes()
    local options = {"None / No Types Found"}
    
    local serverFolder = workspace
        :FindFirstChild("Worlds")
        and workspace.Worlds:FindFirstChild("Targets")
        and workspace.Worlds.Targets:FindFirstChild("Server")
    
    if not serverFolder then
        return options
    end
    
    local seen = {}
    
    -- Scan all descendants for parts/models with "Name" attribute (mob type)
    for _, obj in ipairs(serverFolder:GetDescendants()) do
        if obj:IsA("BasePart") or obj:IsA("Model") then
            local mobType = obj:GetAttribute("Name")
            if mobType and type(mobType) == "string" and #mobType > 0 and not seen[mobType] then
                seen[mobType] = true
                table.insert(options, mobType)
            end
        end
    end
    
    -- Fallback: if no attributes, use unique model names
    if #options == 1 then
        for _, child in ipairs(serverFolder:GetChildren()) do
            local name = child.Name
            if name and name ~= "" and not seen[name] then
                seen[name] = true
                table.insert(options, name)
            end
        end
    end
    
    table.sort(options)
    return options
end

-- Dropdown
local selectedMobType = "None / No Types Found"

local MobTypeDropdown = MainTab:CreateDropdown({
    Name = "Server Mob Types",
    Options = getServerMobTypes(),
    CurrentOption = {"None / No Types Found"},
    MultipleOptions = false,  -- change to true if you want multi-select later
    Flag = "ServerMobTypes",
    Callback = function(option)
        selectedMobType = option[1]
        Rayfield:Notify({
            Title = "Mob Type Selected",
            Content = "Now selected: " .. selectedMobType,
            Duration = 4
        })
        print("Selected mob type:", selectedMobType)
    end,
})

-- Manual refresh button
MainTab:CreateButton({
    Name = "ðŸ”„ Refresh Mob Types",
    Callback = function()
        local newOptions = getServerMobTypes()
        MobTypeDropdown:Refresh(newOptions, true)  -- true = reset to first
        
        Rayfield:Notify({
            Title = "Mob Types Updated",
            Content = "Found " .. (#newOptions - 1) .. " unique types",
            Duration = 4
        })
    end,
})

-- Auto-refresh when folder changes
local serverFolder = workspace
    :WaitForChild("Worlds", 10)
    :WaitForChild("Targets", 10)
    :WaitForChild("Server", 10)

if serverFolder then
    -- Child added
    serverFolder.ChildAdded:Connect(function()
        task.delay(0.5, function()
            local newOpts = getServerMobTypes()
            MobTypeDropdown:Refresh(newOpts, false)  -- false = keep current selection if possible
        end)
    end)
    
    -- Child removed
    serverFolder.ChildRemoved:Connect(function()
        task.delay(0.5, function()
            local newOpts = getServerMobTypes()
            MobTypeDropdown:Refresh(newOpts, false)
        end)
    end)
    
    print("[Mob Dropdown] Auto-refresh enabled on workspace.Worlds.Targets.Server")
else
    warn("[Mob Dropdown] Could not find workspace.Worlds.Targets.Server - auto-refresh disabled")
end

-- Initial scan
task.delay(1, function()
    local initial = getServerMobTypes()
    MobTypeDropdown:Refresh(initial, true)
end)
